<Project Sdk="Microsoft.NET.Sdk">

  <!-- This imports a MSBuild props file, defining the auto-incremented value $(BuildNumber). -->  
  <Import Project="JJ.AutoIncrementVersion.props" Condition="Exists('JJ.AutoIncrementVersion.props')" />

  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <Version Condition="'$(BuildNumber)'==''">1.8.0</Version>
    <Version Condition="'$(BuildNumber)'!=''">1.8.$(BuildNumber)</Version>
  </PropertyGroup>

  <!-- This Build Target writes the next auto-incremented number to a build props file, imported again at the top of the csproj XML. -->
  <Target Name="JJAutoIncrementVersion" BeforeTargets="Build">
    <!-- Default empty BuildNumber to 0 before incrementing. -->
    <PropertyGroup><BuildNumber Condition="'$(BuildNumber)' == ''">0</BuildNumber></PropertyGroup>
    <!-- Increment BuildNumber, then assign back to BuildNumber. -->
    <PropertyGroup><BuildNumber>$([MSBuild]::Add($(BuildNumber), 1))</BuildNumber></PropertyGroup>
    <!-- Write the new version to a MSBuild props file. -->
    <WriteLinesToFile File="$(MSBuildThisFileDirectory)JJ.AutoIncrementVersion.props" Lines="&lt;Project&gt;&lt;PropertyGroup&gt;&lt;BuildNumber&gt;$(BuildNumber)&lt;/BuildNumber&gt;&lt;/PropertyGroup&gt;&lt;/Project&gt;" Overwrite="true" Encoding="UTF-8" />
  </Target>

</Project>
